<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Return Scanner</title>

<script src="https://unpkg.com/html5-qrcode"></script>

<style>
body{font-family:sans-serif;background:#0b0f14;color:#e8f0f8;margin:0;padding:12px}
h2{margin-top:0}
button{padding:8px 12px;border-radius:8px;border:none;background:#1f3a5f;color:white}
input{padding:8px;border-radius:6px;border:1px solid #333;width:100%}
table{width:100%;border-collapse:collapse;margin-top:12px}
th,td{border-bottom:1px solid #333;padding:8px;text-align:left}
.tick{color:#22c55e;font-weight:bold}
.cross{color:#ef4444}
.badge{padding:4px 8px;border-radius:8px;font-size:12px}
.ok{background:#134e2f}
.wait{background:#5b3a00}
#reader{width:100%;max-width:360px;margin:10px 0}
</style>
</head>

<body>

<h2>Return Scanner</h2>

<button onclick="startScanner()">▶ Start Camera</button>

<div id="reader"></div>

<input id="manual" placeholder="Manual barcode input" />

<table>
<thead>
<tr>
  <th>Name</th>
  <th>Barcode 1</th>
  <th>Barcode 2</th>
  <th>Status</th>
</tr>
</thead>
<tbody id="list"></tbody>
</table>

<script>
let data = [
  {name:"Ali", b1:"ALI123", b2:"ALI999", hit1:false, hit2:false},
  {name:"Siti", b1:"SITI111", b2:"", hit1:false, hit2:false},
  {name:"Kumar", b1:"", b2:"KMR888", hit1:false, hit2:false}
];

function isReturned(r){
  return (
    (r.b1 && r.hit1 && r.b2 && r.hit2) ||
    (r.b1 && r.hit1 && !r.b2) ||
    (!r.b1 && r.b2 && r.hit2)
  );
}

function render(){
  const tb = document.getElementById("list");
  tb.innerHTML = "";
  data.forEach(r=>{
    const tr = document.createElement("tr");

    const s1 = r.hit1 ? "✔" : "—";
    const s2 = r.hit2 ? "✔" : "—";

    tr.innerHTML = `
      <td>${r.name}</td>
      <td>${r.b1 || "-"} ${r.hit1?'<span class="tick">✔</span>':''}</td>
      <td>${r.b2 || "-"} ${r.hit2?'<span class="tick">✔</span>':''}</td>
      <td>
        <span class="badge ${isReturned(r)?'ok':'wait'}">
          ${isReturned(r) ? "RETURNED" : "WAITING"}
        </span>
      </td>
    `;
    tb.appendChild(tr);
  });
}

function process(code){
  code = code.trim();
  let matched = false;

  data.forEach(r=>{
    if(r.b1 && r.b1 === code){
      r.hit1 = true;
      matched = true;
    }
    if(r.b2 && r.b2 === code){
      r.hit2 = true;
      matched = true;
    }
  });

  render();
}

document.getElementById("manual").addEventListener("keydown", e=>{
  if(e.key==="Enter"){
    process(e.target.value);
    e.target.value="";
  }
});

let scanner;
function startScanner(){
  scanner = new Html5Qrcode("reader");

  scanner.start(
    { facingMode: "environment" },
    { fps:10, qrbox:250 },
    txt => process(txt),
    err => {}
  );
}

render();
</script>

</body>
</html>
